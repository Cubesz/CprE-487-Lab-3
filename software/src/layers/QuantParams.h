
#pragma once
#include "../Types.h"


const int32_t Zp_macced_player0[] = { 7300, 1958, 15483, -3607, 31125, 75378, 19611, 126723, 2772, 25395, -1298, 3410, 11974, -2976, -362, 5064, 26120, 1848, 145629, -4056, 68171, 42403, 1537, 41489, 78528, -2107, 1829, 83292, 6496, 41668, -3361, -19029 };
const int32_t Zp_macced_player1[] = { 7035, 12748, -2361, 5903, 9507, 5950, 8071, 5395, 18258, 16682, 11850, 16268, 6725, 10925, 9613, 2517, 5099, -1324, 13878, 12685, 7894, 6341, 8999, 15590, 6396, 6244, 27985, 4898, 11102, 2819, 9501, 6639 };
const int32_t Zp_macced_player2[] = { 1728, 1357, 941, 1371, 2145, 1446, 1214, 997, 308, 1347, 725, 411, 1144, 1054, 352, 706, 1003, 1891, 642, 1397, 1617, 1640, -141, 712, 1853, 1028, 1337, 1775, 323, 1837, 928, 1633, 1563, 677, 1703, 1149, 1079, 315, 1542, 303, 1597, 667, -39, 1368, -281, -39, 1403, 1724, 1377, 1683, 2487, 549, 1407, 675, 1163, 420, 2007, 326, 1835, -393, 666, 1653, 1258, 476 };
const int32_t Zp_macced_player3[] = { 2931, 1564, 1930, 1908, 6797, 3332, 1519, 4425, 533, 2269, 5889, 2033, 3885, 2554, 5526, 3005, -471, 5531, 3034, 3067, 3114, 3840, -435, 1029, 3019, 4349, 5512, 3198, 2714, 4694, 5486, 3164, 4718, 4186, 3900, 598, 3359, -1195, 4334, 2270, 870, 4280, 2424, 2915, 6070, 1831, 17, 5524, 3826, 814, 5190, 634, 3309, 221, 555, 4475, 1883, 5986, 2877, 3479, 2344, 2332, 3354, 784 };
const int32_t Zp_macced_player4[] = { 597, -463, 282, -2515, 298, 1739, -1018, 5606, -169, 1589, 3009, 6991, 7160, 5219, 8453, 4047, 8794, 2957, 1953, 4722, 4610, 4303, -455, -2008, 718, 1452, 7880, 1627, 1060, 5615, 2761, 4328, 4501, 5523, 5495, 3072, 4776, 9125, 655, -227, 4176, 1333, 15, -838, 3133, 7374, 4063, 4284, 3198, 975, 1571, -1136, 5861, 2650, -30, 600, 6790, 3896, 1512, -136, 1154, 2943, 1813, 331 };
const int32_t Zp_macced_player5[] = { 3116, 5528, 4909, 391, 5849, 4004, 6484, 2793, 4995, 5090, 6087, 6281, 5765, 7501, 7492, 4305, 7479, 2357, 4022, 3930, -777, 3734, 828, 4318, 5028, 8903, 3734, 7426, 4880, 7178, 3240, 7841, 3555, 2650, 5196, 4619, 4745, 4344, 7982, 4367, 4083, 5073, 6345, 6625, 5000, 3106, 11651, 3322, 4451, 5779, 2176, 2991, 6065, 3894, 3732, 5852, 4839, 4032, 5435, 4903, 4176, 5944, 4846, 5034, 6995, 6716, 2874, 5498, 4555, 3533, 5817, 3637, 4208, 355, 8921, 4906, 7131, 6765, 6573, 5289, 5864, 6190, 11083, 3097, 2469, 2899, 1671, 5991, 3784, 5521, 6122, 13386, 7336, 1512, 1278, 4109, 4727, 10250, 6406, 9086, 4210, 5089, 2147, 3264, 7923, 4115, 5513, 6652, 1990, 6744, 8832, 2369, 3594, 4736, 5842, 7792, 5382, 3927, 11341, 3341, 2509, 3608, 2813, 4578, 5588, 15823, 3189, 4297 };
const int32_t Zp_macced_player6[] = { -3857, -1350, 14791, 6184, 821, 1740, 14091, 84, 7125, 28225, 10311, -183, 9510, -914, 7627, 4851, 1285, 9880, 22230, 11992, 11376, 12936, 15366, -1201, 10049, 7392, 19195, 19397, 12216, -952, 9680, 13032, 9159, -2642, 15056, 22889, 1404, 11150, 7949, 11186, 17380, -818, -3773, 1918, 15584, -1734, 6432, 18708, -1664, 16441, -2111, 10168, -2804, 5548, 11672, 526, -7566, 2139, 10361, -1584, 1726, 6157, 3422, 2682, -3060, 3852, 9908, 9613, 151, -1700, 9791, -1829, 8157, 1660, 11734, 13340, 10099, 20425, 8429, 4646, 8944, 2151, 8563, 18554, 11909, 9710, 8371, 14640, 19628, 298, 19633, 1253, 6735, 157, 10185, 9645, 262, 9327, 806, -3001, 12046, 7340, -716, 3710, -4715, 10029, 9055, 18576, -2158, -5196, 18409, 2597, -274, -1152, 15095, 16147, 2620, 16173, 12601, 19371, 5208, 9580, 1532, 8322, 9868, 12056, 12004, 2818, 5826, 5952, 3384, 17292, 1085, 12514, 13174, 1586, -2154, 11588, 272, 19164, 5009, 2457, -1372, 2440, 7623, 8972, 6808, 14670, 10712, 9373, 15301, -551, -4335, 1294, 19744, -555, -2295, 14103, 5902, 19624, 7067, 10668, 5470, 3949, 5235, 3137, 4333, 1511, 1508, -1360, 18056, 2513, 12573, 12062, 7545, 12417, 3269, 2063, 18437, -3342, -3724, 10664, -3160, 6657, 2185, -2820, 8385, 2901, 2633, 18088, 9830, 7395, -2224, 2738, 6874, 7070, 12395, 8477, 8662, 8194, 22392, -5987, -6297, 7936, 7214, 11509, 15174, 19148, 11897, 5491, 287, 10538, 5728, 14789, 6599, 23107, 20549, 5037, -5771, 5392, 2903, 1620, -3560, -5461, 1253, 6761, 14864, 1892, 17750, 15480, 7795, 7165, -1820, 2277, 9166, 18014, 14887, 8649, 9100, 19697, 4078, -21, -485, 7417, 9018, 10256, 563, 14953, 7784, 1126, 4482, 1449, 29924, 8942, -4455, 7627 };
const int32_t Zp_macced_player7[] = { 3188, 3539, 2987, 3497, 3122, 3223, 3501, 2238, 2645, 2938, 2947, 3969, 3114, 5537, 3797, 3103, 3428, 4029, 2510, 2933, 3172, 3313, 2863, 4023, 3162, 3178, 2666, 3773, 3305, 1497, 2793, 3062, 3385, 2931, 2494, 4450, 2999, 3213, 3750, 3234, 3334, 3327, 4532, 3950, 3263, 2848, 2232, 3237, 2191, 2918, 3216, 2488, 4502, 3769, 4041, 3526, 3166, 3852, 3069, 2068, 3688, 2294, 2939, 2516, 4978, 2074, 3498, 4627, 4625, 4693, 3250, 3495, 3878, 3506, 3242, 3747, 3565, 3325, 3873, 3484, 3574, 3190, 3576, 2624, 2807, 4007, 2097, 3852, 3984, 3303, 4668, 3725, 2704, 2977, 2365, 2351, 2928, 2889, 2162, 3073, 2818, 3693, 4235, 3852, 2357, 3077, 4409, 3514, 4784, 3427, 3264, 2878, 2637, 2448, 3985, 3578, 3720, 4527, 2924, 2750, 2426, 3775, 3791, 3609, 2178, 2574, 1998, 2646, 3959, 4256, 3626, 3948, 3671, 3866, 2808, 4042, 3026, 3984, 4105, 2713, 2438, 3915, 3287, 4048, 2390, 4098, 4065, 3934, 3312, 3732, 3439, 2973, 5632, 3159, 2926, 2893, 3177, 4332, 3661, 3054, 3781, 1963, 2117, 5130, 2506, 2426, 2369, 3207, 3476, 4394, 3340, 1316, 3326, 2955, 3051, 3738, 2982, 3513, 1358, 2623, 2453, 3163, 2746, 3300, 2531, 3785, 2767, 2315, 3800, 2917, 2471, 2190, 3296, 4267, 2970, 2935, 4535, 4028, 2857, 2610 };



// const int player0outputscaler = (1.0f/(78.2820355f / (225.77330403f * 419.30887f)));
// const int player1outputscaler = (1.0f/(30.10063831f / (78.2820355f * 260.8992f)));
const int player0outputscaler = 0x00363129 & 0xFFFFC000;
const int player1outputscaler = 0x00609664 & 0xFFFFC000;
const int player2outputscaler = (1.0f/(38.9806973f / (30.10063831f * 183.42577f)));
const int player3outputscaler = (1.0f/(34.65046495f / (38.9806973f * 234.51324f)));
const int player4outputscaler = (1.0f/(22.17446924f / (34.65046495f * 236.64046f)));
const int player5outputscaler = (1.0f/(14.83324517f / (22.17446924f * 248.70012f)));
const int player6outputscaler = (1.0f/(8.22409603f / (14.83324517f * 227.76791f)));


typedef struct {
    int outputscaler;
    float S_i;
    float S_w;
    const int32_t* zp_macced;
    int Z_i_next;
    bool quantedOutput;
} QParams;


const QParams modelQParams_8q[] = {{player0outputscaler, 226, 419, Zp_macced_player0, -3, true}, {player1outputscaler, 78, 261, Zp_macced_player1, -2, true}, {0, 0, 0, 0, 0, true}, {player2outputscaler, 30, 183, Zp_macced_player2, -1, true}, {player3outputscaler, 39, 235, Zp_macced_player3, -2, true}, {0, 0, 0, 0, 0, true}, {player4outputscaler, 35, 237, Zp_macced_player4, -3, true}, {player5outputscaler, 22, 249, Zp_macced_player5, -2, true}, {0, 0, 0, 0, 0, true}, {0, 0, 0, 0, 0, true}, {player6outputscaler, 15, 228, Zp_macced_player6, -5, true}, {0, 8.22409603, 95.91284, Zp_macced_player7, 0, false}, {0, 0, 0, 0, 0, false}};

typedef struct {
    bool relu;
    bool maxpool;
    int input_size;
    int filter_w;
    int filter_h;
    int filter_c;
    int single_filter_size;
    int output_w; // width pre pooling if pooling
    int output_h; // height pre pooling if pooling
    int output_elements_per_channel; // output elements post pooling if pooling
    int inp_diff_fw;
    int inp_diff_fh;
    int inp_diff_fc;
    int inp_diff_ow;
    int q_scale_fx_pnt; // Q0.32 format. Hardware is actually Q0.18 though and also the top 5 or so bits are assumed to be 0.
    int q_zero;
    const int32_t* zp_macced;
} AccelParams;

const AccelParams aplayer0 = {
    .relu = true,
    .maxpool = false,
    .input_size = 3 * 64 * 64,
    .filter_w = 5,
    .filter_h = 5,
    .filter_c = 3,
    .single_filter_size = 5 * 5 *3,
    .output_w = 60,
    .output_h = 60,
    .output_elements_per_channel = 60*60,
    .inp_diff_fw = 60,
    .inp_diff_fh = 3836,
    .inp_diff_fc = -8451,
    .inp_diff_ow = -8447,
    .q_scale_fx_pnt = 0x00363129, // 0.0008269047213 in Q0.32.
    .q_zero = modelQParams_8q[0].Z_i_next,
    .zp_macced = Zp_macced_player0
};

const AccelParams aplayer1 = {
    .relu = true,
    .maxpool = true,
    .input_size = 115200,
    .filter_w = 5,
    .filter_h = 5,
    .filter_c = 32,
    .single_filter_size = 5 * 5 * 32,
    .output_w = 56,
    .output_h = 56,
    .output_elements_per_channel = 28*28,
    // .output_elements_per_channel = 56*56,
    .inp_diff_fw = 56,
    .inp_diff_fh = 3356,
    .inp_diff_fc = -111843,
    .inp_diff_ow = -111839,
    .q_scale_fx_pnt = 0x00609664, // 0.001473807791 in Q0.32.
    .q_zero = modelQParams_8q[1].Z_i_next,
    .zp_macced = Zp_macced_player1
};

const AccelParams aplayer2 = { // not complete yet
    .relu = true,
    .maxpool = false,
    .input_size = 28*28*32,
    .filter_w = 3,
    .filter_h = 3,
    .filter_c = 32,
    .single_filter_size = 3 * 3 * 32,
    .output_w = 26,
    .output_h = 26,
    .output_elements_per_channel = 26*26,
    // .output_elements_per_channel = 56*56,
    .inp_diff_fw = 56,
    .inp_diff_fh = 3356,
    .inp_diff_fc = -111843,
    .inp_diff_ow = -111839,
    .q_scale_fx_pnt = 0x00609664, // 0.001473807791 in Q0.32.
    .q_zero = modelQParams_8q[3].Z_i_next,
    .zp_macced = Zp_macced_player2
};


const int32_t Zp_macced_player0_4b[] = {22, 6, 47, -11, 95, 229, 60, 385, 8, 77, -4, 10, 36, -9, -1, 15, 79, 6, 442, -12, 207, 129, 5, 126, 239, -6, 6, 253, 20, 127, -10, -58 };
const int32_t Zp_macced_player1_4b[] = {21, 39, -7, 18, 29, 18, 25, 16, 55, 51, 36, 49, 20, 33, 29, 8, 15, -4, 42, 39, 24, 19, 27, 47, 19, 19, 85, 15, 34, 9, 29, 20};
const int32_t Zp_macced_player2_4b[] = {5, 4, 3, 4, 7, 4, 4, 3, 1, 4, 2, 1, 3, 3, 1, 2, 3, 6, 2, 4, 5, 5, 0, 2, 6, 3, 4, 5, 1, 6, 3, 5, 5, 2, 5, 3, 3, 1, 5, 1, 5, 2, 0, 4, -1, 0, 4, 5, 4, 5, 8, 2, 4, 2, 4, 1, 6, 1, 6, -1, 2, 5, 4, 1};
const int32_t Zp_macced_player3_4b[] = {9, 5, 6, 6, 21, 10, 5, 13, 2, 7, 18, 6, 12, 8, 17, 9, -1, 17, 9, 9, 9, 12, -1, 3, 9, 13, 17, 10, 8, 14, 17, 10, 14, 13, 12, 2, 10, -4, 13, 7, 3, 13, 7, 9, 18, 6, 0, 17, 12, 2, 16, 2, 10, 1, 2, 14, 6, 18, 9, 11, 7, 7, 10, 2};
const int32_t Zp_macced_player4_4b[] = {2, -1, 1, -8, 1, 5, -3, 17, -1, 5, 9, 21, 22, 16, 26, 12, 27, 9, 6, 14, 14, 13, -1, -6, 2, 4, 24, 5, 3, 17, 8, 13, 14, 17, 17, 9, 15, 28, 2, -1, 13, 4, 0, -3, 10, 22, 12, 13, 10, 3, 5, -3, 18, 8, 0, 2, 21, 12, 5, 0, 4, 9, 6, 1};
const int32_t Zp_macced_player5_4b[] = {9, 17, 15, 1, 18, 12, 20, 8, 15, 15, 18, 19, 18, 23, 23, 13, 23, 7, 12, 12, -2, 11, 3, 13, 15, 27, 11, 23, 15, 22, 10, 24, 11, 8, 16, 14, 14, 13, 24, 13, 12, 15, 19, 20, 15, 9, 35, 10, 14, 18, 7, 9, 18, 12, 11, 18, 15, 12, 17, 15, 13, 18, 15, 15, 21, 20, 9, 17, 14, 11, 18, 11, 13, 1, 27, 15, 22, 21, 20, 16, 18, 19, 34, 9, 8, 9, 5, 18, 11, 17, 19, 41, 22, 5, 4, 12, 14, 31, 19, 28, 13, 15, 7, 10, 24, 13, 17, 20, 6, 20, 27, 7, 11, 14, 18, 24, 16, 12, 34, 10, 8, 11, 9, 14, 17, 48, 10, 13};
const int32_t Zp_macced_player6_4b[] = {-12, -4, 45, 19, 2, 5, 43, 0, 22, 86, 31, -1, 29, -3, 23, 15, 4, 30, 68, 36, 35, 39, 47, -4, 31, 22, 58, 59, 37, -3, 29, 40, 28, -8, 46, 70, 4, 34, 24, 34, 53, -2, -11, 6, 47, -5, 20, 57, -5, 50, -6, 31, -9, 17, 35, 2, -23, 6, 31, -5, 5, 19, 10, 8, -9, 12, 30, 29, 0, -5, 30, -6, 25, 5, 36, 41, 31, 62, 26, 14, 27, 7, 26, 56, 36, 29, 25, 44, 60, 1, 60, 4, 20, 0, 31, 29, 1, 28, 2, -9, 37, 22, -2, 11, -14, 30, 28, 56, -7, -16, 56, 8, -1, -3, 46, 49, 8, 49, 38, 59, 16, 29, 5, 25, 30, 37, 36, 9, 18, 18, 10, 53, 3, 38, 40, 5, -7, 35, 1, 58, 15, 7, -4, 7, 23, 27, 21, 45, 33, 28, 46, -2, -13, 4, 60, -2, -7, 43, 18, 60, 21, 32, 17, 12, 16, 10, 13, 5, 5, -4, 55, 8, 38, 37, 23, 38, 10, 6, 56, -10, -11, 32, -10, 20, 7, -9, 25, 9, 8, 55, 30, 22, -7, 8, 21, 21, 38, 26, 26, 25, 68, -18, -19, 24, 22, 35, 46, 58, 36, 17, 1, 32, 17, 45, 20, 70, 62, 15, -18, 16, 9, 5, -11, -17, 4, 21, 45, 6, 54, 47, 24, 22, -6, 7, 28, 55, 45, 26, 28, 60, 12, 0, -1, 23, 27, 31, 2, 45, 24, 3, 14, 4, 91, 27, -14, 23};
const int32_t Zp_macced_player7_4b[] = {10, 11, 9, 11, 9, 10, 11, 7, 8, 9, 9, 12, 9, 17, 12, 9, 10, 12, 8, 9, 10, 10, 9, 12, 10, 10, 8, 11, 10, 5, 8, 9, 10, 9, 8, 14, 9, 10, 11, 10, 10, 10, 14, 12, 10, 9, 7, 10, 7, 9, 10, 8, 14, 11, 12, 11, 10, 12, 9, 6, 11, 7, 9, 8, 15, 6, 11, 14, 14, 14, 10, 11, 12, 11, 10, 11, 11, 10, 12, 11, 11, 10, 11, 8, 9, 12, 6, 12, 12, 10, 14, 11, 8, 9, 7, 7, 9, 9, 7, 9, 9, 11, 13, 12, 7, 9, 13, 11, 15, 10, 10, 9, 8, 7, 12, 11, 11, 14, 9, 8, 7, 11, 12, 11, 7, 8, 6, 8, 12, 13, 11, 12, 11, 12, 9, 12, 9, 12, 12, 8, 7, 12, 10, 12, 7, 12, 12, 12, 10, 11, 10, 9, 17, 10, 9, 9, 10, 13, 11, 9, 11, 6, 6, 16, 8, 7, 7, 10, 11, 13, 10, 4, 10, 9, 9, 11, 9, 11, 4, 8, 7, 10, 8, 10, 8, 12, 8, 7, 12, 9, 8, 7, 10, 13, 9, 9, 14, 12, 9, 8};

const int player0outputscaler_4b = (1.0f/(4.31475786f / (12.44419786f * 23.111511f)));
const int player1outputscaler_4b = (1.0f/(1.6590903f / (4.31475786f * 14.380271f)));
const int player2outputscaler_4b = (1.0f/(2.14854237f / (1.6590903f * 10.110082f)));
const int player3outputscaler_4b = (1.0f/(1.90986815f / (2.14854237f * 12.925927f)));
const int player4outputscaler_4b = (1.0f/(1.22221484f / (1.90986815f * 13.043175f)));
const int player5outputscaler_4b = (1.0f/(0.81758044f / (1.22221484f * 13.707881f)));
const int player6outputscaler_4b = (1.0f/(0.45329663f / (0.81758044f * 12.554137f)));


const QParams modelQParams_4q[] = {{player0outputscaler_4b, 12, 23, Zp_macced_player0_4b, 0, true}, {player1outputscaler_4b, 4, 14, Zp_macced_player1_4b, 0, true}, {0, 0, 0, 0, 0, true}, {player2outputscaler_4b, 2, 10, Zp_macced_player2_4b, 0, true}, {player3outputscaler_4b, 2, 13, Zp_macced_player3_4b, 0, true}, {0, 0, 0, 0, 0, true}, {player4outputscaler_4b, 2, 13, Zp_macced_player4_4b, 0, true}, {player5outputscaler_4b, 1, 14, Zp_macced_player5_4b, 0, true}, {0, 0, 0, 0, 0, true}, {0, 0, 0, 0, 0, true}, {player6outputscaler_4b, 1, 13, Zp_macced_player6_4b, 0, true}, {0, 0.45329663, 5.2865343, Zp_macced_player7_4b, 0, false}, {0, 0, 0, 0, 0, false}};
